<article class="page-shell section-stack mx-auto max-w-5xl">
  <header class="page-header">
    <h1 class="page-title">PsPing network latency test</h1>
    <p class="page-lead">
      The browser-based Azure speed test cannot measure ICMP ping or TCP ping due to platform
      limits. Use PsPing from the PsTools suite to measure latency directly against Azure targets,
      including ICMP ping, TCP ping, and bandwidth tests.
    </p>
  </header>

  <section class="section-block" aria-labelledby="run-psping-heading">
    <h2 id="run-psping-heading" class="section-title">Run PsPing latency test</h2>
    <p class="text-text-muted">
      To use the PsPing tool for a network latency test, follow these steps:
    </p>
    <ol class="flex list-none flex-col gap-4 p-0" aria-label="4 steps to run PsPing">
      <li class="flex flex-row items-start gap-3 max-md:flex-col">
        <span class="step-number" aria-hidden="true">1</span>
        <div class="flex-1 text-base leading-relaxed text-text-body">
          <span class="sr-only">Step 1: </span>
          <a
            href="https://learn.microsoft.com/en-us/sysinternals/downloads/pstools"
            target="_blank"
            rel="noopener noreferrer"
            class="link-primary inline-flex items-center gap-1"
            aria-label="Download PsTools (opens in new tab)"
          >
            Download PsTools
            <app-lucide-icon name="external-link" class="size-3" aria-hidden="true" />
          </a>
        </div>
      </li>
      <li class="flex flex-row items-start gap-3 max-md:flex-col">
        <span class="step-number" aria-hidden="true">2</span>
        <div class="flex-1 text-base leading-relaxed text-text-body">
          <span class="sr-only">Step 2: </span>
          Extract the entire package and open a command prompt.
        </div>
      </li>
      <li class="flex flex-row items-start gap-3 max-md:flex-col">
        <span class="step-number" aria-hidden="true">3</span>
        <div class="flex-1 text-base leading-relaxed text-text-body">
          <span class="sr-only">Step 3: </span>
          Enter this command:
          <kbd
            class="mx-1 inline-block rounded-lg border border-border-soft bg-surface-muted px-2 py-0.5 font-mono text-sm font-semibold text-text-body"
          >
            psping target:port
          </kbd>
          (replace "target" with an IP address or DNS name of publicly accessible virtual machines,
          storage, SQL databases, or other endpoints).
        </div>
      </li>
      <li class="flex flex-row items-start gap-3 max-md:flex-col">
        <span class="step-number" aria-hidden="true">4</span>
        <div class="flex-1 space-y-3 text-base leading-relaxed text-text-body">
          <span class="sr-only">Step 4: </span>
          Upon completion, you'll see output displaying latency results in milliseconds (as shown
          below when using a storage endpoint and port 80 as target):
          <figure
            class="relative mt-3 w-full overflow-hidden rounded-2xl border border-border-soft shadow-xl"
            style="aspect-ratio: 560/292"
          >
            <img
              class="absolute inset-0 h-full w-full object-cover"
              ngSrc="assets/images/psping.webp"
              alt="PsPing command output showing TCP connect statistics to Azure storage endpoint, including minimum, maximum, and average latency in milliseconds"
              fill
              priority
              sizes="(min-width: 1024px) 45vw, (min-width: 640px) 70vw, 95vw"
            />
            <figcaption class="sr-only">
              PsPing output showing latency test results with connection statistics
            </figcaption>
          </figure>
        </div>
      </li>
    </ol>
  </section>

  <section class="section-block" aria-labelledby="comparison-heading">
    <h2 id="comparison-heading" class="section-title">Browser test vs PsPing</h2>
    <p class="text-text-muted">
      Both tools measure latency, but at different layers of the network stack. Choose based on what
      you need to measure.
    </p>
    <div class="table-shell">
      <table class="table-base">
        <thead class="table-head">
          <tr>
            <th class="px-4 py-3">Aspect</th>
            <th class="px-4 py-3">Browser test</th>
            <th class="px-4 py-3">PsPing</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-border-soft">
          <tr class="table-row-hover">
            <td class="px-4 py-3 font-semibold text-text-strong">Protocol</td>
            <td class="px-4 py-3 text-text-body">HTTPS requests to Azure Blob Storage</td>
            <td class="px-4 py-3 text-text-body">TCP connect or ICMP echo</td>
          </tr>
          <tr class="table-row-hover">
            <td class="px-4 py-3 font-semibold text-text-strong">What it measures</td>
            <td class="px-4 py-3 text-text-body">
              Real-world application latency including DNS, TLS handshake, and HTTP processing
            </td>
            <td class="px-4 py-3 text-text-body">
              Raw network round-trip time without application overhead
            </td>
          </tr>
          <tr class="table-row-hover">
            <td class="px-4 py-3 font-semibold text-text-strong">Use case</td>
            <td class="px-4 py-3 text-text-body">
              Simulates actual user experience for web apps, APIs, and cloud services
            </td>
            <td class="px-4 py-3 text-text-body">
              Baseline network diagnostics and infrastructure-level validation
            </td>
          </tr>
          <tr class="table-row-hover">
            <td class="px-4 py-3 font-semibold text-text-strong">Requirements</td>
            <td class="px-4 py-3 text-text-body">None (runs in browser)</td>
            <td class="px-4 py-3 text-text-body">PsTools download, command line</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section class="section-block" aria-labelledby="faq-heading">
    <h2 id="faq-heading" class="section-title">Frequently asked questions</h2>
    <div class="faq-list">
      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">Where can I learn more about PsPing parameters?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          Visit the
          <a
            href="https://learn.microsoft.com/en-us/sysinternals/downloads/pstools"
            target="_blank"
            rel="noopener noreferrer"
            class="link-primary inline-flex items-center gap-1"
          >
            Microsoft Sysinternals PsTools page
            <app-lucide-icon name="external-link" class="size-3" aria-hidden="true" />
          </a>
          for detailed documentation on each PsPing parameter.
        </div>
      </details>
      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">Why doesn't regular ping work with Azure?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          Azure blocks external ICMP protocol, so the general ping.exe using ICMP won't function.
          However, PsPing can directly test connectivity to an unblocked specific TCP port.
        </div>
      </details>
      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">How do I test latency between Azure virtual machines?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          To test latency between virtual machines in the same VNET or different VNETs across
          various regions, see
          <a routerLink="/Azure/RegionToRegionLatency" class="link-primary">
            Region to Region Latency
          </a>
          and
          <a
            href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-test-latency"
            target="_blank"
            rel="noopener noreferrer"
            class="link-primary inline-flex items-center gap-1"
          >
            Test VM network latency
            <app-lucide-icon name="external-link" class="size-3" aria-hidden="true" /> </a
          >.
        </div>
      </details>
    </div>
  </section>
</article>
