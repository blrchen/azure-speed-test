<section class="section-block">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <span class="text-sm text-text-muted">
      <span class="font-semibold text-text-strong">{{ selectedRegionCount() }}</span> /
      {{ totalRegionCount }} regions selected
    </span>
    <button
      type="button"
      class="btn btn-outline btn--sm"
      (click)="clearSelection()"
      [disabled]="selectedRegionCount() === 0"
    >
      Clear all
    </button>
  </div>

  <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 xl:grid-cols-3">
    @for (group of regionGroups; track trackByGroup($index, group)) {
      @let groupActive = isGroupChecked(group) || isGroupIndeterminate(group);
      <article
        class="card card-interactive flex flex-col gap-3"
        [class.border-brand]="groupActive"
        [class.ring-2]="groupActive"
        [class.ring-brand]="groupActive"
      >
        <header class="flex items-center justify-between gap-3">
          <h3 class="text-base font-bold text-text-strong">{{ group.regionGroup }}</h3>

          <button type="button" class="btn btn-outline btn--sm" (click)="onChange(null, group)">
            {{ isGroupChecked(group) ? 'Deselect all' : 'Select all' }}
          </button>
        </header>

        <div class="flex flex-wrap gap-2" role="group" [attr.aria-label]="group.regionGroup">
          @for (region of group?.regions; track trackByRegion($index, region)) {
            @let isActive = isRegionChecked(region.regionId);
            <label class="chip" [class.chip-active]="isActive" [class.chip-inactive]="!isActive">
              <input
                type="checkbox"
                [id]="region.regionId"
                [checked]="isActive"
                (change)="onChange(region, group)"
                [attr.aria-label]="region.displayName"
                class="sr-only"
              />
              <span>{{ region.displayName }}</span>
            </label>
          }
        </div>
      </article>
    }
  </div>
</section>
