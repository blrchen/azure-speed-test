<article class="page-shell section-stack mx-auto max-w-5xl">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a class="breadcrumb-link" routerLink="/">Home</a>
    <span class="breadcrumb-separator">/</span>
    <a class="breadcrumb-link" [routerLink]="['/Information/AzureRegions']">Azure regions</a>
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-current" aria-current="page">{{ breadcrumbLabel() }}</span>
  </nav>

  <header class="page-header">
    <h1 class="page-title">{{ regionData()?.displayName ?? regionId() }}</h1>
    <p class="page-lead">{{ regionDescription() }}</p>
  </header>

  <section class="section-block" aria-labelledby="status-heading">
    <h2 id="status-heading" class="sr-only">Region status</h2>
    <div class="flex flex-wrap items-center gap-3 text-sm">
      <span
        class="inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-semibold"
        [class]="
          regionData()?.restricted ? 'bg-warning/20 text-warning' : 'bg-success/20 text-success'
        "
      >
        <app-lucide-icon
          [name]="regionData()?.restricted ? 'lock' : 'check-circle'"
          class="h-3.5 w-3.5"
          aria-hidden="true"
        />
        {{ regionData()?.restricted ? 'Restricted Access' : 'Generally Available' }}
      </span>
      <span class="text-sm font-semibold tracking-[0.04em] text-brand lowercase">
        {{ regionData()?.regionId?.toLowerCase() ?? regionIdLowercase() }}
      </span>
    </div>
  </section>

  <section class="section-block" aria-labelledby="map-heading">
    <h2 id="map-heading" class="sr-only">Region map</h2>
    <div class="relative overflow-hidden rounded-2xl border border-border-soft shadow-xl">
      @if (!mapLoaded()) {
        <div class="absolute inset-0 z-20 flex items-center justify-center bg-surface-muted">
          <div class="flex flex-col items-center gap-3">
            <span class="spinner text-brand"></span>
            <span class="text-sm text-text-muted">Loading map...</span>
          </div>
        </div>
      }
      <div
        class="pointer-events-none absolute inset-x-0 top-0 z-10 h-16 bg-gradient-to-b from-surface-raised/80 to-transparent"
      ></div>
      <div id="region-map" class="h-[320px] w-full md:h-[400px]"></div>
      <div class="absolute bottom-4 left-4 z-10">
        <span
          class="rounded-lg bg-surface-raised/90 px-3 py-1.5 text-sm font-semibold text-text-strong shadow-lg backdrop-blur-sm"
        >
          {{ regionData()?.displayName }}
        </span>
      </div>
    </div>
  </section>

  <section class="section-block" aria-labelledby="actions-heading">
    <h2 id="actions-heading" class="sr-only">Quick actions</h2>
    <div class="flex flex-wrap gap-3">
      <a
        class="btn btn-primary"
        [routerLink]="['/Azure/Latency']"
        [queryParams]="{ region: regionData()?.regionId }"
      >
        <app-lucide-icon name="activity" class="h-4 w-4" aria-hidden="true" />
        Test latency
      </a>
      <a
        class="btn btn-secondary"
        [routerLink]="['/Information/AzureIpRanges', 'AzureCloud.' + regionIdLowercase()]"
        [state]="{ source: 'region' }"
      >
        <app-lucide-icon name="network" class="h-4 w-4" aria-hidden="true" />
        View IP ranges
      </a>
      @if (hasCoordinates()) {
        <a
          class="btn btn-outline"
          [href]="regionCoordinatesHref()"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Open in Google Maps (opens in new tab)"
        >
          <app-lucide-icon name="map" class="h-4 w-4" aria-hidden="true" />
          Open in Maps
          <app-lucide-icon name="external-link" class="ml-1 h-3 w-3" aria-hidden="true" />
        </a>
      }
    </div>
  </section>

  <section class="section-block" aria-labelledby="details-heading">
    <h2 id="details-heading" class="section-title">Region details</h2>
    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      <!-- Location Card -->
      <article class="card space-y-3">
        <div class="flex items-center gap-3">
          <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-brand/10">
            <app-lucide-icon name="map-pin" class="h-5 w-5 text-brand" aria-hidden="true" />
          </div>
          <h3 class="font-semibold text-text-strong">Location</h3>
        </div>
        <dl class="grid grid-cols-[160px,1fr] gap-y-2 text-sm">
          <div class="contents">
            <dt class="text-text-muted">Geography</dt>
            <dd class="text-right font-medium">
              {{ regionData()?.geography || 'Not specified' }}
            </dd>
          </div>
          <div class="contents">
            <dt class="text-text-muted">Datacenter</dt>
            <dd class="font-medium">{{ regionData()?.datacenterLocation || 'N/A' }}</dd>
          </div>
          <div class="contents" [class.hidden]="!hasCoordinates()">
            <dt class="text-text-muted">Coordinates</dt>
            <dd>
              <a
                class="link-primary inline-flex items-center gap-1 font-mono text-xs"
                [href]="regionCoordinatesHref()"
                target="_blank"
                rel="noopener noreferrer"
                aria-label="View coordinates on Google Maps (opens in new tab)"
              >
                {{ regionData()?.latitude }}, {{ regionData()?.longitude }}
                <app-lucide-icon name="external-link" class="h-3 w-3" aria-hidden="true" />
              </a>
            </dd>
          </div>
        </dl>
      </article>

      <!-- Infrastructure Card -->
      <article class="card space-y-3">
        <div class="flex items-center gap-3">
          <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-success/10">
            <app-lucide-icon name="server" class="h-5 w-5 text-success" aria-hidden="true" />
          </div>
          <h3 class="font-semibold text-text-strong">Infrastructure</h3>
        </div>
        <dl class="grid grid-cols-[160px,1fr] gap-y-2 text-sm">
          <div class="contents">
            <dt class="text-text-muted">Availability zones</dt>
            <dd class="font-medium">
              <span
                [class]="
                  regionData()?.availabilityZoneCount ? 'badge badge-success' : 'text-text-muted'
                "
              >
                {{
                  regionData()?.availabilityZoneCount
                    ? regionData()?.availabilityZoneCount + ' AZ'
                    : 'None'
                }}
              </span>
            </dd>
          </div>
          <div class="contents">
            <dt class="text-text-muted">Paired region</dt>
            <dd>
              <a
                class="link-primary"
                [class.hidden]="!regionData()?.pairedRegion"
                [routerLink]="buildRegionRouterLink(regionData()?.pairedRegion)"
              >
                {{ regionData()?.pairedRegion }}
              </a>
              <span class="text-text-muted" [class.hidden]="regionData()?.pairedRegion">None</span>
            </dd>
          </div>
          <div class="contents">
            <dt class="text-text-muted">Launched</dt>
            <dd class="font-medium">{{ regionData()?.launchYear || 'N/A' }}</dd>
          </div>
        </dl>
      </article>

      <!-- Access Card -->
      <article class="card space-y-3">
        <div class="flex items-center gap-3">
          <div
            class="flex h-10 w-10 items-center justify-center rounded-lg"
            [class]="regionData()?.restricted ? 'bg-warning/10' : 'bg-success/10'"
          >
            <app-lucide-icon
              [name]="regionData()?.restricted ? 'lock' : 'unlock'"
              class="h-5 w-5"
              [class]="regionData()?.restricted ? 'text-warning' : 'text-success'"
              aria-hidden="true"
            />
          </div>
          <h3 class="font-semibold text-text-strong">Access</h3>
        </div>
        <dl class="grid grid-cols-[160px,1fr] gap-y-2 text-sm">
          <div class="contents">
            <dt class="text-text-muted">Status</dt>
            <dd class="font-medium">
              {{ regionData()?.restricted ? 'Restricted' : 'Generally Available' }}
            </dd>
          </div>
          <div class="contents">
            <dt class="text-text-muted">Available to</dt>
            <dd class="font-medium">
              {{ regionData()?.availableTo || 'All customers' }}
            </dd>
          </div>
          <div class="contents" [class.hidden]="!regionData()?.dataResidency">
            <dt class="text-text-muted">Data residency</dt>
            <dd class="text-xs">
              {{ regionData()?.dataResidency }}
            </dd>
          </div>
        </dl>
      </article>
    </div>
  </section>

  @if (relatedRegions().length) {
    <section class="section-block" aria-labelledby="related-heading">
      <h2 id="related-heading" class="section-title">Related regions</h2>
      <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
        @for (region of relatedRegions(); track region.regionId; let idx = $index) {
          <a
            class="card card-interactive animate-fade-slide-in flex items-center gap-3"
            [routerLink]="buildRegionRouterLink(region.displayName)"
          >
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-brand/10">
              <app-lucide-icon name="server" class="h-5 w-5 text-brand" aria-hidden="true" />
            </div>
            <div class="min-w-0 flex-1">
              <div class="truncate font-semibold text-text-strong">{{ region.displayName }}</div>
              <div class="truncate text-xs text-text-muted">{{ region.datacenterLocation }}</div>
            </div>
          </a>
        }
      </div>
    </section>
  }
</article>
