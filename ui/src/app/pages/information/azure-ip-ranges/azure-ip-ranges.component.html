<article class="page-shell section-stack mx-auto max-w-5xl">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a class="breadcrumb-link" routerLink="/">Home</a>
    <span class="breadcrumb-separator">/</span>
    @if (breadcrumbSource() === 'region') {
      <a class="breadcrumb-link" routerLink="/Information/AzureIpRangesByRegion"
        >Azure IP ranges by region</a
      >
    } @else {
      <a class="breadcrumb-link" routerLink="/Information/AzureIpRangesByService"
        >Azure IP ranges by service</a
      >
    }
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-current" aria-current="page">{{ serviceTagId() }}</span>
  </nav>

  <header class="page-header">
    <h1 class="page-title">Azure IP ranges - {{ serviceTagId() }}</h1>
    <p class="page-lead">
      {{ tagInsights().metaDescription }}
    </p>
  </header>

  <section class="section-block" aria-labelledby="ip-ranges-heading" [attr.aria-busy]="isLoading()">
    <header class="flex flex-wrap items-center justify-between gap-3">
      <h2 id="ip-ranges-heading" class="section-title">
        IP address ranges for {{ tableData()?.serviceTagId ?? serviceTagId() }}
      </h2>
      <app-copy-button
        [text]="copyText()"
        icon="copy"
        label="Copy all"
        ariaLabel="Copy all IP address prefixes"
        [resetOn]="serviceTagId()"
      />
    </header>
    <div class="card">
      <div class="card-body min-h-[160px]" aria-live="polite">
        @if (isLoading()) {
          <div class="animate-pulse space-y-3" role="status">
            <span class="sr-only">Loading IP ranges...</span>
            <div class="h-3 rounded-full bg-surface-muted"></div>
            <div class="h-3 rounded-full bg-surface-muted"></div>
            <div class="h-3 rounded-full bg-surface-muted"></div>
            <div class="h-3 rounded-full bg-surface-muted"></div>
            <div class="h-3 rounded-full bg-surface-muted"></div>
          </div>
        } @else {
          @if (tableData()?.ipAddressPrefixes?.length) {
            @if (ipv4Addresses().length > 0) {
              <h3 class="mb-2 text-base font-semibold text-text-strong">
                IPv4 addresses ({{ ipv4Addresses().length }})
              </h3>
              <div
                class="ip-prefix-list mb-3 scrollbar-thin"
                aria-label="IPv4 address prefixes"
                tabindex="0"
                role="region"
              >
                @for (prefix of visibleIpv4Addresses(); track prefix) {
                  <span class="ip-prefix-list-item">{{ prefix }}</span>
                }
              </div>
              @if (hasMoreIpv4()) {
                <div class="mb-4 flex items-center gap-3">
                  <button class="btn btn-outline btn--sm" type="button" (click)="showMoreIpv4()">
                    Show more ({{ remainingIpv4Count() }} remaining)
                  </button>
                  <button class="btn btn-outline btn--sm" type="button" (click)="showAllIpv4()">
                    Show all
                  </button>
                </div>
              }
            }
            @if (ipv6Addresses().length > 0) {
              <h3 class="mb-2 text-base font-semibold text-text-strong">
                IPv6 addresses ({{ ipv6Addresses().length }})
              </h3>
              <div
                class="ip-prefix-list mb-3 scrollbar-thin"
                aria-label="IPv6 address prefixes"
                tabindex="0"
                role="region"
              >
                @for (prefix of visibleIpv6Addresses(); track prefix) {
                  <span class="ip-prefix-list-item">{{ prefix }}</span>
                }
              </div>
              @if (hasMoreIpv6()) {
                <div class="mb-4 flex items-center gap-3">
                  <button class="btn btn-outline btn--sm" type="button" (click)="showMoreIpv6()">
                    Show more ({{ remainingIpv6Count() }} remaining)
                  </button>
                  <button class="btn btn-outline btn--sm" type="button" (click)="showAllIpv6()">
                    Show all
                  </button>
                </div>
              }
            }
          } @else {
            <span class="text-sm text-text-muted">No prefixes returned for this service tag.</span>
          }
        }
      </div>
    </div>
  </section>

  @if (!isLoading() && tableData()?.ipAddressPrefixes?.length) {
    <section class="section-block" aria-labelledby="use-cases-heading">
      <h2 id="use-cases-heading" class="section-title">Common use cases</h2>
      <p class="mb-3 text-sm text-text-muted">
        This service tag often supports Azure networking tasks such as:
      </p>
      <ul class="list-disc space-y-2 pl-5 text-sm text-text-body">
        @for (useCase of commonUseCases; track useCase) {
          <li>{{ useCase }}</li>
        }
      </ul>
    </section>
  }

  <section class="section-block" aria-labelledby="explore-heading">
    <h2 id="explore-heading" class="section-title">Explore more IP data</h2>
    <div class="flex flex-wrap gap-3">
      <a class="btn btn-outline btn--sm" routerLink="/Information/AzureIpRangesByService">
        IP ranges by service
      </a>
      <a class="btn btn-outline btn--sm" routerLink="/Information/AzureIpRangesByRegion">
        IP ranges by region
      </a>
    </div>
  </section>

  <section class="section-block" aria-labelledby="resources-heading">
    <h2 id="resources-heading" class="section-title">Additional resources</h2>
    <p class="mb-3 text-sm text-text-muted">
      Stay current with Azure service tag updates and automation tooling.
    </p>
    <div class="resource-grid">
      <article class="card card-resource">
        <h3 class="card-title">Azure IP ranges downloads</h3>
        <p class="card-description">
          Access weekly updates for all Azure clouds to keep network rules current.
        </p>
        <a
          href="https://www.microsoft.com/en-us/download/details.aspx?id=56519"
          target="_blank"
          rel="noopener noreferrer"
          class="card-cta"
          aria-label="Learn more about Azure IP ranges downloads (opens in new tab)"
        >
          Learn more
          <app-lucide-icon name="external-link" class="ml-1 size-3" aria-hidden="true" />
        </a>
      </article>
      <article class="card card-resource">
        <h3 class="card-title">Service tags overview</h3>
        <p class="card-description">
          Learn how service tags simplify network security management in Azure.
        </p>
        <a
          href="https://learn.microsoft.com/azure/virtual-network/service-tags-overview"
          target="_blank"
          rel="noopener noreferrer"
          class="card-cta"
          aria-label="Learn more about service tags overview (opens in new tab)"
        >
          Learn more
          <app-lucide-icon name="external-link" class="ml-1 size-3" aria-hidden="true" />
        </a>
      </article>
      <article class="card card-resource">
        <h3 class="card-title">Programmatic access</h3>
        <p class="card-description">
          Use the Service Tag Discovery API to automate service tag updates in your tooling.
        </p>
        <a
          href="https://learn.microsoft.com/rest/api/virtualnetwork/servicetags/list"
          target="_blank"
          rel="noopener noreferrer"
          class="card-cta"
          aria-label="Learn more about programmatic access (opens in new tab)"
        >
          Learn more
          <app-lucide-icon name="external-link" class="ml-1 size-3" aria-hidden="true" />
        </a>
      </article>
    </div>
  </section>
</article>
