<section class="region-groups">
  <h2 class="visually-hidden">Azure region groups</h2>
  <div class="region-groups__summary">
    <div class="region-groups__summary-primary">
      <span class="region-groups__summary-count">
        {{ selectedRegionCount() }} / {{ totalRegionCount }} regions selected
      </span>
      <span
        class="region-groups__summary-message"
        [attr.data-status]="selectedRegionCount() === 0 ? 'alert' : null"
      >
        @if (selectedRegionCount() === 0) {
          Select at least one region to start your test.
        } @else {
          Ready to run your test.
        }
      </span>
    </div>
    <button
      type="button"
      class="app-button app-button--link app-button--sm region-groups__summary-clear"
      (click)="clearSelection()"
      [disabled]="selectedRegionCount() === 0"
    >
      Clear all
    </button>
  </div>

  <div class="region-groups__list">
    @for (group of regionGroups; track trackByGroup($index, group)) {
      <article
        class="region-group-row"
        [attr.data-state]="isGroupChecked(group) || isGroupIndeterminate(group) ? 'active' : null"
      >
        <header class="region-group-row__header">
          <h3 class="region-group-row__title">{{ group.regionGroup }}</h3>
          <button type="button" class="region-group-row__action" (click)="onChange(null, group)">
            {{ isGroupChecked(group) ? 'Deselect all' : 'Select all' }}
          </button>
        </header>

        <div class="region-chip-collection" role="group" [attr.aria-label]="group.regionGroup">
          @for (region of group?.regions; track trackByRegion($index, region)) {
            <label
              class="region-chip"
              [attr.data-active]="isRegionChecked(region.regionId) ? 'true' : null"
            >
              <input
                type="checkbox"
                [id]="region.regionId"
                [checked]="isRegionChecked(region.regionId)"
                (change)="onChange(region, group)"
                [attr.aria-label]="region.displayName"
              />
              <span class="region-chip__label">{{ region.displayName }}</span>
            </label>
          }
        </div>
      </article>
    }
  </div>
</section>
