<article class="page-shell section-stack mx-auto max-w-5xl">
  <header class="page-header">
    <h1 class="page-title">Azure IP lookup</h1>
    <p class="page-lead">
      Find Azure service tag, region, and network metadata for any IP address or domain. Share
      results easily with a link to the same lookup.
    </p>
  </header>

  <section class="section-block" aria-labelledby="lookup-heading">
    <h2 id="lookup-heading" class="sr-only">IP lookup</h2>
    <form
      class="flex flex-col gap-2"
      [formGroup]="ipLookupForm"
      (ngSubmit)="submitForm()"
      novalidate
    >
      @let ipOrDomainControl = ipLookupForm.get('ipOrDomain');
      <div class="flex items-center justify-between gap-3">
        <label for="ipOrDomain" class="text-sm font-medium text-text-body"
          >IP address or domain</label
        >
        <app-copy-button
          [text]="shareableUrl()"
          icon="share-2"
          label="Share"
          ariaLabel="Copy shareable link to clipboard"
          [resetOn]="shareableUrl()"
        />
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <div class="relative flex-1">
          <app-lucide-icon
            name="search"
            class="pointer-events-none absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-text-muted"
            aria-hidden="true"
          />
          <input
            id="ipOrDomain"
            class="h-9 w-full rounded-md border border-border-contrast bg-transparent pr-3 pl-9 text-sm text-text-body shadow-sm transition-colors placeholder:text-text-placeholder focus:ring-1 focus:ring-brand focus:outline-none"
            name="ipOrDomain"
            type="search"
            formControlName="ipOrDomain"
            placeholder="e.g. 1.1.1.1 or www.azure.com"
            required
            minlength="3"
            maxlength="253"
            autocapitalize="off"
            spellcheck="false"
            autocomplete="off"
            [class.is-invalid]="ipOrDomainControl?.invalid && ipOrDomainControl?.touched"
          />
        </div>
        <button
          class="btn btn-primary"
          type="submit"
          [disabled]="ipLookupForm.invalid || isLoading()"
        >
          @if (isLoading()) {
            <span class="spinner-sm"></span>
            Looking up...
          } @else {
            IP lookup
          }
        </button>
      </div>
      @if (ipOrDomainControl?.hasError('required') && ipOrDomainControl?.touched) {
        <div class="text-sm text-danger-dark">An IP address or domain name is required.</div>
      } @else if (ipOrDomainControl?.hasError('invalidIpOrDomain') && ipOrDomainControl?.touched) {
        <div class="text-sm text-danger-dark">
          Enter a valid IPv4, IPv6 address, or domain name.
        </div>
      }
    </form>

    @if (!isLoading() && errorMessage()) {
      <div class="alert alert--error mt-3" role="alert" aria-live="polite">
        <app-lucide-icon name="alert-circle" class="h-4 w-4" aria-hidden="true" />
        {{ errorMessage() }}
      </div>
    }

    @if (isLoading()) {
      <div class="mt-4 flex justify-center py-4">
        <div class="spinner text-brand">
          <span class="sr-only">Loading...</span>
        </div>
      </div>
    }

    @if (!isLoading() && !currentSearchTerm() && !errorMessage()) {
      <div class="card min-h-[200px]">
        <div class="card-body flex flex-col items-center justify-center gap-4 py-12 text-center">
          <div
            class="flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-br from-primary/15 to-primary/25"
          >
            <app-lucide-icon name="globe" class="h-8 w-8 text-brand" aria-hidden="true" />
          </div>
          <div class="space-y-1">
            <p class="text-sm text-text-muted">
              Enter an IP address or domain to discover its Azure service tag.
            </p>
          </div>
        </div>
      </div>
    }

    @if (!isLoading() && hasResult()) {
      <div class="card mb-4 shadow-sm">
        <header class="card-header flex items-center gap-3">
          <div class="flex h-8 w-8 items-center justify-center rounded-full bg-success/10">
            <app-lucide-icon name="check-circle" class="h-4 w-4 text-success" aria-hidden="true" />
          </div>
          <div>
            <span class="font-semibold">Matched Azure service tags for</span>
            <code
              class="ml-1 rounded bg-surface-muted px-2 py-0.5 font-mono text-sm text-text-strong"
            >
              {{ currentSearchTerm() }}
            </code>
          </div>
        </header>
        <div class="card-body">
          <div class="hidden md:block">
            <div class="table-shell">
              <table class="table-base">
                <thead class="table-head">
                  <tr>
                    <th scope="col" class="px-4 py-3 text-left">IP address</th>
                    <th scope="col" class="px-4 py-3 text-left">Service tag ID</th>
                    <th scope="col" class="px-4 py-3 text-left">Prefix</th>
                    <th scope="col" class="px-4 py-3 text-left">Region</th>
                    <th scope="col" class="px-4 py-3 text-left">System service</th>
                    <th scope="col" class="px-4 py-3 text-left">Network features</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-border-soft">
                  @for (r of result() ?? []; track r.serviceTagId) {
                    <tr class="table-row-hover animate-fade-slide-in">
                      <td class="px-4 py-3">
                        <code class="text-sm break-all">{{ r.ipAddress }}</code>
                      </td>
                      <td class="px-4 py-3">
                        <a
                          class="link-primary font-semibold"
                          [routerLink]="['/Information/AzureIpRanges', r.serviceTagId]"
                          [state]="{ source: 'service' }"
                        >
                          {{ r.serviceTagId }}
                        </a>
                      </td>
                      <td class="px-4 py-3">{{ r.ipAddressPrefix }}</td>
                      <td class="px-4 py-3">{{ r.region }}</td>
                      <td class="px-4 py-3">{{ r.systemService }}</td>
                      <td class="px-4 py-3">{{ r.networkFeatures }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
          <div class="flex flex-col gap-3 md:hidden">
            @for (r of result() ?? []; track r.serviceTagId) {
              <article
                class="animate-fade-slide-in rounded-2xl border border-brand/30 bg-surface-muted/90 p-4 shadow-sm"
              >
                <dl class="space-y-3 text-sm">
                  <div class="flex flex-col gap-1">
                    <dt class="eyebrow-xs">IP address</dt>
                    <dd class="font-mono text-text-strong">{{ r.ipAddress }}</dd>
                  </div>
                  <div class="flex flex-col gap-1">
                    <dt class="eyebrow-xs">Service tag ID</dt>
                    <dd>
                      <a
                        class="link-primary font-semibold"
                        [routerLink]="['/Information/AzureIpRanges', r.serviceTagId]"
                        [state]="{ source: 'service' }"
                      >
                        {{ r.serviceTagId }}
                      </a>
                    </dd>
                  </div>
                  <div class="flex flex-col gap-1">
                    <dt class="eyebrow-xs">Prefix</dt>
                    <dd class="text-text-body">{{ r.ipAddressPrefix }}</dd>
                  </div>
                  <div class="flex flex-col gap-1">
                    <dt class="eyebrow-xs">Region</dt>
                    <dd class="text-text-body">{{ r.region }}</dd>
                  </div>
                  <div class="flex flex-col gap-1">
                    <dt class="eyebrow-xs">System service</dt>
                    <dd class="text-text-body">{{ r.systemService }}</dd>
                  </div>
                  <div class="flex flex-col gap-1">
                    <dt class="eyebrow-xs">Network features</dt>
                    <dd class="text-text-body">{{ r.networkFeatures }}</dd>
                  </div>
                </dl>
              </article>
            }
          </div>
        </div>
      </div>
    } @else if (
      !isLoading() && currentSearchTerm() && (result()?.length ?? 0) === 0 && !errorMessage()
    ) {
      <div class="alert">
        No Azure service tag entries were found for
        <strong>{{ currentSearchTerm() }}</strong>
      </div>
    }
  </section>

  <section class="section-block" aria-labelledby="use-cases-heading">
    <h2 id="use-cases-heading" class="section-title">Common use cases</h2>
    <div
      class="divide-y divide-border-soft overflow-hidden rounded-xl border border-border-soft bg-surface-raised"
    >
      <div class="flex items-start gap-4 p-4">
        <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10">
          <app-lucide-icon name="server" class="h-5 w-5 text-primary" aria-hidden="true" />
        </div>
        <div>
          <h3 class="font-semibold text-text-strong">Azure VIP lookup</h3>
          <p class="mt-0.5 text-sm text-text-muted">
            Check if an IP is an Azure VIP and identify associated service tags and regions.
          </p>
        </div>
      </div>
      <div class="flex items-start gap-4 p-4">
        <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10">
          <app-lucide-icon name="search" class="h-5 w-5 text-primary" aria-hidden="true" />
        </div>
        <div>
          <h3 class="font-semibold text-text-strong">Traffic analysis</h3>
          <p class="mt-0.5 text-sm text-text-muted">
            Identify the source of unknown IPs found in client access logs, IIS logs, or Azure Log
            Analytics.
          </p>
        </div>
      </div>
      <div class="flex items-start gap-4 p-4">
        <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10">
          <app-lucide-icon name="shield-check" class="h-5 w-5 text-primary" aria-hidden="true" />
        </div>
        <div>
          <h3 class="font-semibold text-text-strong">DDoS investigation</h3>
          <p class="mt-0.5 text-sm text-text-muted">
            Determine the origin of unfamiliar IPs appearing in DDoS mitigation logs.
          </p>
        </div>
      </div>
    </div>
  </section>

  <section class="section-block" aria-labelledby="faq-heading">
    <h2 id="faq-heading" class="section-title">Frequently asked questions</h2>
    <div class="faq-list">
      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">What are Azure service tags?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          Azure service tags group IP ranges for Azure services. Instead of maintaining IP
          allowlists, you can reference a single service tag in your NSG or firewall rules. Each
          service tag has an ID and network features that describe its usage.
        </div>
      </details>

      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">How does the Azure IP Lookup tool work?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          The lookup submits your IP address or domain to the Azure IP Lookup API. The API maps the
          address to Azure service tags published by Microsoft and returns the matching service tag
          ID, region, and network feature metadata. Results update weekly as Microsoft releases new
          IP data.
        </div>
      </details>

      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">Does the lookup support IPv6 addresses?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          Yes. The tool accepts IPv4, IPv6, and domain names. IPv6 prefixes are returned exactly as
          Microsoft publishes them in the weekly service tag downloads.
        </div>
      </details>

      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">How often does Azure update IP data?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          Microsoft publishes updated IP ranges weekly. Use the
          <a
            class="link-primary inline-flex items-center gap-1"
            href="https://www.microsoft.com/en-us/download/details.aspx?id=56519"
            target="_blank"
            rel="noopener noreferrer"
          >
            Azure IP Ranges and Service Tags - Public Cloud
            <app-lucide-icon name="external-link" class="h-3 w-3" aria-hidden="true" />
          </a>
          download to stay current.
        </div>
      </details>

      <details class="faq-item group">
        <summary class="faq-summary">
          <span class="faq-question">Can I automate lookups?</span>
          <app-lucide-icon name="chevron-down" class="faq-icon" aria-hidden="true" />
        </summary>
        <div class="faq-body">
          Yes. The Azure Speed IP Lookup API accepts a simple GET request at
          <code>/api/ipAddress?ipOrDomain=&lt;ipAddressOrDomain&gt;</code>
          . Supply either an IP address or domain name and the service returns the same payload you
          see in the UI.
          <div class="table-shell">
            <table class="table-base">
              <thead class="table-head">
                <tr>
                  <th scope="col" class="px-4 py-3">Lookup type</th>
                  <th scope="col" class="px-4 py-3">Example URL</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-border-soft">
                <tr class="table-row-hover">
                  <td class="px-4 py-3">Domain name</td>
                  <td class="px-4 py-3">
                    <a
                      class="link-primary"
                      href="https://www.azurespeed.com/api/ipAddress?ipOrDomain=www.azure.com"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      https://www.azurespeed.com/api/ipAddress?ipOrDomain=www.azure.com
                    </a>
                  </td>
                </tr>
                <tr class="table-row-hover">
                  <td class="px-4 py-3">IPv4 address</td>
                  <td class="px-4 py-3">
                    <a
                      class="link-primary"
                      href="https://www.azurespeed.com/api/ipAddress?ipOrDomain=104.45.231.79"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      https://www.azurespeed.com/api/ipAddress?ipOrDomain=104.45.231.79
                    </a>
                  </td>
                </tr>
                <tr class="table-row-hover">
                  <td class="px-4 py-3">IPv6 address</td>
                  <td class="px-4 py-3">
                    <a
                      class="link-primary"
                      href="https://www.azurespeed.com/api/ipAddress?ipOrDomain=2603:1030:0800:0005:0000:0000:BFEE:A418"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      https://www.azurespeed.com/api/ipAddress?ipOrDomain=2603:1030:0800:0005:0000:0000:BFEE:A418
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </details>
    </div>
  </section>

  <section class="section-block" aria-labelledby="resources-heading">
    <h2 id="resources-heading" class="section-title">Additional resources</h2>
    <div class="resource-grid">
      <article class="card card-resource">
        <div class="flex items-center gap-3">
          <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10">
            <app-lucide-icon name="github" class="h-5 w-5 text-primary" aria-hidden="true" />
          </div>
          <h3 class="card-title">API source code</h3>
        </div>
        <p class="card-description">
          Check out the open-source Azure IP Lookup API that powers this tool.
        </p>
        <a
          href="https://github.com/blrchen/azure-ip-lookup"
          target="_blank"
          rel="noopener noreferrer"
          class="card-cta"
          aria-label="View API source code on GitHub (opens in new tab)"
        >
          View on GitHub
          <app-lucide-icon name="external-link" class="ml-1 size-3" aria-hidden="true" />
        </a>
      </article>
      <article class="card card-resource">
        <div class="flex items-center gap-3">
          <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10">
            <app-lucide-icon name="tag" class="h-5 w-5 text-primary" aria-hidden="true" />
          </div>
          <h3 class="card-title">Service tags overview</h3>
        </div>
        <p class="card-description">
          Learn how service tags simplify Azure network security management.
        </p>
        <a
          href="https://learn.microsoft.com/azure/virtual-network/service-tags-overview"
          target="_blank"
          rel="noopener noreferrer"
          class="card-cta"
          aria-label="Learn more about service tags overview (opens in new tab)"
        >
          Learn more
          <app-lucide-icon name="external-link" class="ml-1 size-3" aria-hidden="true" />
        </a>
      </article>
      <article class="card card-resource">
        <div class="flex items-center gap-3">
          <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10">
            <app-lucide-icon name="code" class="h-5 w-5 text-primary" aria-hidden="true" />
          </div>
          <h3 class="card-title">Service Tag API docs</h3>
        </div>
        <p class="card-description">
          Use the REST API to automate service tag lookups and updates.
        </p>
        <a
          href="https://learn.microsoft.com/rest/api/virtualnetwork/servicetags/list"
          target="_blank"
          rel="noopener noreferrer"
          class="card-cta"
          aria-label="Learn more about Service Tag API docs (opens in new tab)"
        >
          Learn more
          <app-lucide-icon name="external-link" class="ml-1 size-3" aria-hidden="true" />
        </a>
      </article>
      <article class="card card-resource">
        <div class="flex items-center gap-3">
          <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10">
            <app-lucide-icon name="terminal" class="h-5 w-5 text-primary" aria-hidden="true" />
          </div>
          <h3 class="card-title">PowerShell tooling</h3>
        </div>
        <p class="card-description">
          Manage service tags programmatically with the Azure PowerShell module.
        </p>
        <a
          href="https://learn.microsoft.com/powershell/module/az.network/get-aznetworkservicetag"
          target="_blank"
          rel="noopener noreferrer"
          class="card-cta"
          aria-label="Learn more about PowerShell tooling (opens in new tab)"
        >
          Learn more
          <app-lucide-icon name="external-link" class="ml-1 size-3" aria-hidden="true" />
        </a>
      </article>
    </div>
  </section>
</article>
