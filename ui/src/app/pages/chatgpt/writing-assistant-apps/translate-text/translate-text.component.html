<article class="page-shell section-stack mx-auto max-w-5xl">
  <header class="page-header">
    <h1 class="page-title">ChatGPT text translator</h1>
    <p class="page-lead">
      Instantly translate text into over 20 languages with the ChatGPT-powered translator.
    </p>
  </header>

  <section class="section-block" aria-labelledby="translator-heading">
    <h2 id="translator-heading" class="sr-only">Text translator</h2>
    <form
      [formGroup]="userContentForm"
      (ngSubmit)="submitForm()"
      autocomplete="off"
      class="mb-3"
      novalidate
    >
      <fieldset class="form group mb-3">
        <label for="userContent" class="form-label transition-colors group-focus-within:text-brand">
          Text to Translate
        </label>
        <textarea
          class="form-control min-h-[6.5rem]"
          id="userContent"
          formControlName="userContent"
          placeholder="Type or paste your text here..."
          required
          rows="3"
        ></textarea>
        <small class="form-note mt-1"> {{ userContentLength() }}/5000 characters </small>
        @if (userContentForm.controls['userContent'].errors?.['maxlength']) {
          <div class="alert alert--error" role="alert">
            Character limit exceeded. Please limit your text to 5000 characters.
          </div>
        }
      </fieldset>
      <fieldset class="form mb-3">
        <legend class="mb-3">Select Translation Language</legend>
        <div class="flex flex-wrap gap-x-4 gap-y-2">
          @for (lang of languages; track $index) {
            <div class="form-radio">
              <input
                type="radio"
                id="{{ lang }}"
                name="responseLanguage"
                [value]="lang"
                formControlName="responseLanguage"
                required
                class="form-radio-input"
                [checked]="lang === userContentForm.get('responseLanguage')?.value"
                (change)="onResponseLanguageChange(lang)"
              />
              <label for="{{ lang }}" class="form-radio-label">{{ lang }}</label>
            </div>
          }
        </div>
      </fieldset>
      <button
        type="submit"
        class="btn btn-primary mr-2"
        [disabled]="userContentForm.invalid || isLoading()"
      >
        Translate
      </button>
      <button type="button" class="btn btn-secondary" (click)="resetForm()">Reset</button>
      @if (errorMessage()) {
        <div class="alert alert--error mt-3" role="alert" aria-live="polite">
          {{ errorMessage() }}
        </div>
      }
    </form>
  </section>

  <section class="section-block" aria-labelledby="results-heading" aria-live="polite">
    <div class="card">
      <div
        class="card-header relative flex flex-wrap items-center justify-between gap-3 overflow-hidden"
      >
        <div
          class="absolute inset-0 bg-gradient-to-r from-brand/5 via-transparent to-transparent"
          aria-hidden="true"
        ></div>
        <h2 id="results-heading" class="section-title relative">Translation result</h2>
        <button
          type="button"
          class="btn btn-outline btn--sm group relative"
          [disabled]="!hasResult() || isLoading()"
          (click)="copyToClipboard(result() ?? '')"
        >
          @if (isCopyIdle()) {
            <app-lucide-icon
              name="copy"
              class="size-4 transition-transform group-hover:scale-110"
              [strokeWidth]="2"
              aria-hidden="true"
            />
            <span>Copy</span>
          }
          @if (isCopySuccess()) {
            <app-lucide-icon
              name="check"
              class="size-4 text-success"
              [strokeWidth]="2"
              aria-hidden="true"
            />
            <span>Copied!</span>
          }
          @if (isCopyError()) {
            <app-lucide-icon
              name="x"
              class="size-4 text-danger"
              [strokeWidth]="2"
              aria-hidden="true"
            />
            <span>Failed</span>
          }
        </button>
      </div>
      <div class="card-body flex min-h-[240px] flex-col justify-center gap-4 py-4 sm:min-h-[260px]">
        @if (isLoading()) {
          <div class="flex flex-1 flex-col justify-center space-y-3" role="status">
            <span class="sr-only">Translating...</span>
            <div class="h-4 w-24 animate-pulse rounded bg-surface-muted"></div>
            <div class="h-4 w-full animate-pulse rounded bg-surface-muted/80 delay-75"></div>
            <div class="h-4 w-5/6 animate-pulse rounded bg-surface-muted/60 delay-150"></div>
            <div class="h-4 w-4/5 animate-pulse rounded bg-surface-muted/50 delay-200"></div>
          </div>
        } @else if (hasResult()) {
          <div class="flex flex-1 flex-col">
            <p class="m-0 leading-relaxed break-words whitespace-pre-wrap text-text-strong">
              {{ result() }}
            </p>
          </div>
        } @else {
          <div
            class="flex flex-1 flex-col items-center justify-center gap-4 text-center text-text-muted"
          >
            <app-lucide-icon
              name="languages"
              class="size-16 animate-pulse text-text-muted/50"
              aria-hidden="true"
            />
            <p class="m-0 text-sm">Enter text and select a language to translate</p>
          </div>
        }
      </div>
    </div>
    <app-assistant-footer />
  </section>
</article>
